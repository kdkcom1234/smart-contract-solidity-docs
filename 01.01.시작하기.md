솔리디티(Solidity) 기반 스마트 컨트랙트 개발과 폴리곤(Polygon) 테스트넷에 배포하는 과정은 다음 단계로 구분할 수 있습니다:

1. **Hardhat 환경 설정**
2. **스마트 컨트랙트 작성**
3. **폴리곤 테스트넷에 배포**
4. **Node.js 환경에서 스마트 컨트랙트 실행**

### 1. Hardhat 환경 설정

먼저, Hardhat 프로젝트를 설정합니다. 새 디렉토리를 만들고, 초기화합니다:

```bash
mkdir my-hardhat-project
cd my-hardhat-project
npm init -y
npm install --save-dev hardhat
```

이제 Hardhat 설정을 시작합니다:

```bash
npx hardhat
```

이 명령어는 Hardhat 설정 마법사를 시작합니다. 기본 프로젝트 설정을 선택하고 필요한 의존성을 설치합니다.

Hardhat 설정이 완료되면, `hardhat.config.js` 파일을 열고 Polygon 테스트넷 구성을 추가합니다. 이를 위해 `@nomiclabs/hardhat-ethers` 및 `dotenv` 패키지를 설치합니다:

```bash
npm install --save-dev @nomiclabs/hardhat-ethers dotenv
```

`hardhat.config.js` 파일을 열고 다음과 같이 수정합니다:

```javascript
require("@nomiclabs/hardhat-ethers");
require("dotenv").config();

module.exports = {
  solidity: "0.8.4",
  networks: {
    mumbai: {
      url: process.env.MUMBAI_RPC_URL, // 환경 변수에서 RPC URL을 읽어옵니다.
      accounts: [process.env.PRIVATE_KEY], // 개인 키를 환경 변수에서 읽어옵니다.
    },
  },
};
```

`.env` 파일을 프로젝트 루트에 생성하고 Polygon 테스트넷(Mumbai)의 RPC URL과 개인 키를 추가합니다:

```
MUMBAI_RPC_URL=https://matic-mumbai.chainstacklabs.com
PRIVATE_KEY=여기에_개인_키를_입력
```

### 2. 스마트 컨트랙트 작성

`contracts` 디렉토리에 `Greeting.sol` 이름으로 파일을 생성하고 다음과 같이 스마트 컨트랙트를 작성합니다:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;

contract Greeting {
    uint256 public count;

    function incrementCounter() public {
        count += 1;
    }

    function greet(string memory name) public pure returns (string memory) {
        return string(abi.encodePacked("Hello, ", name));
    }
}
```

### 3. 폴리곤 테스트넷에 배포

스마트 컨트랙트를 컴파일하고 폴리곤 테스트넷에 배포하기 위한 스크립트를 작성합니다. `scripts` 디렉토리에 `deploy.js` 파일을 생성하고 다음과 같이 작성합니다:

```javascript
async function main() {
  const Greeting = await ethers.getContractFactory("Greeting");
  const greeting = await Greeting.deploy();

  await greeting.deployed();

  console.log(`Greeting deployed to: ${greeting.address}`);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
```

이제 다음 명령어로 배포를 진행합니다:

```bash
npx hardhat run scripts/deploy.js --network mumbai
```

### 4. Node.js에서 스마트 컨트랙트 실행

ABI와 스마트 컨트랙트 주소를 사용하여 Node.js 환경에서 스마트 컨트랙트를 실행합니다. 배포 후 생성된 `artifacts` 디렉토리에서 ABI 파일을 찾습니다.

`index.js` 파일을

생성하고 다음과 같이 작성합니다:

```javascript
const { ethers } = require("ethers");
require("dotenv").config();

const abi = [여기에_ABI를_붙여넣기]; // ABI를 복사하여 붙여넣습니다.
const contractAddress = "여기에_스마트_컨트랙트_주소를_입력"; // 배포 후 받은 주소를 입력합니다.

const provider = new ethers.providers.JsonRpcProvider(
  process.env.MUMBAI_RPC_URL
);
const signer = new ethers.Wallet(process.env.PRIVATE_KEY, provider);
const greetingContract = new ethers.Contract(contractAddress, abi, signer);

async function main() {
  const tx = await greetingContract.incrementCounter();
  await tx.wait();
  const count = await greetingContract.count();
  console.log(`Current count: ${count}`);

  const greeting = await greetingContract.greet("World");
  console.log(greeting);
}

main();
```

이제 Node.js 환경에서 `index.js` 파일을 실행하여 스마트 컨트랙트의 메서드를 호출할 수 있습니다.

이 과정을 통해 Hardhat을 사용한 스마트 컨트랙트 개발 및 폴리곤 테스트넷 배포 방법을 간략히 알아보았습니다. 필요에 따라 스마트 컨트랙트의 로직을 조정하고, 배포 스크립트를 추가적으로 수정할 수 있습니다.
